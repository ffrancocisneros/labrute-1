# Nixpacks configuration for Railway deployment
# Single service: server serves the React frontend

[phases.setup]
nixPkgs = ["nodejs_20", "yarn"]
cmds = ["corepack enable"]

[phases.install]
cmds = [
  "cp prisma/package.reference.json prisma/package.json",
  "yarn install --immutable",
  "cp prisma/package.reference.json prisma/package.json"
]

[phases.build]
cmds = [
  "cd server && yarn prisma generate",
  "cp prisma/package.reference.json prisma/package.json",
  "yarn compile",
  "DISABLE_ESLINT_PLUGIN=true CI=false yarn build:client"
]

[start]
cmd = "bash scripts/start-production.sh"

[variables]
NODE_ENV = "production"

